import{j as v,a as w}from"./index-91b021b3.js";let c=null;const h=e=>{if(!e.objectStoreNames.contains("routers")){const n=e.createObjectStore("routers",{keyPath:"id",autoIncrement:!0});n.createIndex("name","name",{unique:!1}),n.createIndex("path","path",{unique:!1}),n.createIndex("moduleType","moduleType",{unique:!1})}},S=(e="global",n="myDB")=>{const o=window.indexedDB.open(n);return new Promise((r,s)=>{o.onerror=function(t){s()},o.onsuccess=function(t){console.log("onsuccess"),c=t.target.result,h(c),r(c)},o.onupgradeneeded=function(t){c=t.target.result,console.log("onupgradeneeded"),h(c),r(c)}})},m=(e,n="global")=>{const o=c.transaction([n],"readwrite").objectStore(n).add(e);return new Promise((r,s)=>{o.onsuccess=function(t){console.log("数据写入成功"),r(t)},o.onerror=function(t){console.log("数据写入失败"),s(t)}})},x=(e="global",n="global")=>{const o=c.transaction([n],"readwrite").objectStore(n).delete(e);return new Promise((r,s)=>{o.onsuccess=function(t){console.log("数据删除成功"),r(!0)},o.onerror=function(t){console.log("数据删除失败"),s(t)}})},j=(e,n="global")=>{!e.id&&(e.id="global");const o=c.transaction([n],"readwrite").objectStore(n).put(e);return new Promise((r,s)=>{o.onsuccess=function(t){console.log("数据更新成功"),r(t)},o.onerror=function(t){console.log("数据更新失败"),s(t)}})},I=async(e,n="global")=>(!e.id&&(e.id="global"),await y(e.id)?(console.log("存在数据，即将更新"),j(e,n)):(console.log("不存在数据，即将新增"),m(e,n))),y=(e="global",n="global")=>new Promise((o,r)=>{var t=c.transaction([n]).objectStore(n),u=t.get(e);u.onerror=function(a){console.log("事务失败"),r(a)},u.onsuccess=function(a){u.result?o(u.result):(console.log("未获得数据记录"),o(null))}});function P(e,n,o){return new Promise((r,s)=>{try{const l=c.transaction([e],"readonly").objectStore(e).index(n).getAll(o);l.onsuccess=function(i){const g=i.target.result;g?r(g):s()}}catch(t){s(t)}})}function q(e,n,o){return new Promise((r,s)=>{const l=c.transaction([e],"readwrite").objectStore(e).index(n).getAll(o);l.onsuccess=function(i){const g=i.target.result;let f=[];g.map(d=>{(d[n]=o)&&f.push(x(d.id,e))}),Promise.all(f).then(()=>{r()}).catch(()=>{s()})}})}const D=(e="global")=>new Promise((n,o)=>{const r=c.transaction(e).objectStore(e),s=[];r.openCursor().onsuccess=function(t){const u=t.target.result;if(u){const a={db:u.source.transaction.db.name,table:u.source.name};s.push({value:u.value,otherIf:a}),u.continue()}else n(s)}});function B(e,n,o,r,s){return new Promise((t,u)=>{let a=[],l=0,i=!0;const f=c.transaction(e,"readwrite").objectStore(e).index(n).openCursor(IDBKeyRange.only(o));f.onsuccess=function(d){let b=d.target.result;if(r>1&&i){i=!1,b.advance((r-1)*s);return}b?(a.push(b.value),l++,l<s?b.continue():(b=null,t(a),console.log("分页查询结果",a))):(t(a),console.log("分页查询结果",a))},f.onerror=function(d){u(d)}})}const p={db:c,cursorGetDataByIndexAndPage:B,getDataByIndex:P,removeDataByIndex:q,init:S,save:m,update:j,saveOrUpdate:I,read:y,readAll:D,remove:x};window.indexdbHelper=p;function C(){async function e(){const o=await p.readAll("routers");console.log("routers",o)}async function n(){await p.save({name:"name"+parseInt(Math.random()*100),path:"path"+parseInt(Math.random()*100),moduleType:Math.round(Math.random())},"routers")}return v("div",{children:[w("button",{onClick:n,children:"添加数据"}),w("button",{onClick:e,children:"查询数据"})]})}export{C as default};
